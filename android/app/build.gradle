apply plugin: "com.android.application"
apply plugin: "org.jetbrains.kotlin.android"
apply plugin: "com.facebook.react"
apply plugin: "com.google.gms.google-services"

/* React-Native Gradle Plugin */
react { autolinkLibrariesWithApp() }

/* ───────── 공통 설정 ───────── */
def enableProguardInReleaseBuilds = false
def jscFlavor = "io.github.react-native-community:jsc-android:2026004.+"

android {
    namespace "com.finguard"
    compileSdk 35

    defaultConfig {
        applicationId "com.finguard"
        minSdk 24
        targetSdk 35
        versionCode 1
        versionName "1.0"
    }

    signingConfigs {
        debug {
            storeFile file('debug.keystore')
            storePassword 'android'
            keyAlias 'androiddebugkey'
            keyPassword 'android'
        }
    }
    buildTypes {
        debug   { signingConfig signingConfigs.debug }
        release {
            signingConfig signingConfigs.debug
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"),
                          "proguard-rules.pro"
        }
    }
}

/* ───────── 의존성 ───────── */
dependencies {
    /* React-Native 프레임워크 */
    implementation("com.facebook.react:react-android")

    /* Google Play-services ─ 위치 모듈만 20.x 로 고정 (RN Geolocation 5.3.x 호환) */
    implementation("com.google.android.gms:play-services-location:20.0.0")

    /* Firebase – BoM 사용 권장 (필요 모듈 버전을 일관성 있게) */
    implementation(platform("com.google.firebase:firebase-bom:33.14.0"))
    implementation("com.google.firebase:firebase-messaging")   // FCM

    /* JavaScript 엔진 */
    if (hermesEnabled.toBoolean()) {
        implementation("com.facebook.react:hermes-android")
    } else {
        implementation(jscFlavor)
    }
}

/* ───────── 버전 충돌 방지 ─────────
   다른 라이브러리가 play-services-location 21.x를 끌어올라도
   20.0.0 으로 덮어쓰도록 강제  */
subprojects {
    configurations.all {
        resolutionStrategy {
            force "com.google.android.gms:play-services-location:20.0.0"
        }
    }
}